<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Maintenance Request</title>

<!-- EmailJS SDK v4 -->
<script type="module" src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  emailjs.init("sLNm5JCzwihAuVon0"); // Replace with your EmailJS User ID
</script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f4f8;
  margin: 0;
  padding: 0;
}

.maintenance-page {
  max-width: 700px;
  margin: 40px auto;
  padding: 20px;
}

.form-card {
  background: #fff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.form-card h2 {
  text-align: center;
  margin-bottom: 25px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

textarea {
  resize: vertical;
}

button.submit-btn {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  background: #0078D4;
  color: white;
  cursor: pointer;
}

button.submit-btn:hover {
  background: #005A9E;
}

.logo-container {
  text-align: center;
  margin-top: 30px;
}

.logo-container .logo {
  max-width: 180px;
  display: block;
  margin: 0 auto 10px;
}

.soar-text {
  font-size: 36px;
  font-weight: bold;
  background: linear-gradient(90deg, red, orange, yellow, green, blue, indigo, violet);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
</style>
</head>
<body>

<div class="maintenance-page">

  <!-- Maintenance Form -->
  <div class="form-card">
    <h2>Maintenance Request Form</h2>

    <input id="requester" placeholder="Requested By">
    <input id="contact" placeholder="Contact Info / Phone">
    <select id="resHouse">
      <option value="">Select Residential House</option>
      <option>Lee House</option>
      <option>Alcoa House</option>
      <option>Cusick House</option>
      <option>Countryside House</option>
      <option>Cherokee House</option>
      <option>Dell House</option>
      <option>Gladstone House</option>
      <option>Glascock House</option>
      <option>Jett House</option>
      <option>May House</option>
      <option>Merritt House</option>
      <option>Emma House</option>
      <option>Wright House</option>
      <option>Raulston House</option>
      <option>Louisville House</option>
      <optio>Soar Main Office</optio>
    </select>

    <input id="dateSubmitted" type="text" value="" readonly>
    <input id="expectedDate" type="date" placeholder="Expected Date of Completion">
    <textarea id="description" rows="4" placeholder="Description of Work to be Performed"></textarea>
    <textarea id="materials" rows="3" placeholder="Materials Required"></textarea>

    <button class="submit-btn" onclick="submitMaintenance()">Submit Maintenance Request</button>
  </div>

  <!-- Logo + SOAR TN -->
  <div class="logo-container">
    <img src="logo.png" alt="SOAR TN Logo" class="logo">
    <h1 class="soar-text">SOAR TN</h1>
  </div>
</div>

<script>
// Set date submitted automatically
document.getElementById("dateSubmitted").value = new Date().toLocaleString();

function generateTicket() {
  return "SOAR-" + Date.now();
}

function launchConfetti() {
  confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
}

function submitMaintenance() {
  const ticket = generateTicket();

  const requester = document.getElementById("requester").value.trim();
  const contact = document.getElementById("contact").value.trim();
  const resHouse = document.getElementById("resHouse").value;
  const dateSubmitted = document.getElementById("dateSubmitted").value;
  const expectedDate = document.getElementById("expectedDate").value;
  const description = document.getElementById("description").value.trim();
  const materials = document.getElementById("materials").value.trim();

  if (!requester || !contact || !resHouse || !description) {
    alert("Please fill in all required fields.");
    return;
  }

  // EmailJS send
  emailjs.send("service_lk56r2m", "template_au6bbjp", {
    ticket: ticket,
    requester: requester,
    contact: contact,
    resHouse: resHouse,
    dateSubmitted: dateSubmitted,
    expectedDate: expectedDate,
    description: description,
    materials: materials,
    to_email: "soarhr@soartn.org",
    cc_email: "toosandra@gmail.com" //testing email, replace with cheryl, alisha and koby
  }).then(() => {
    launchConfetti();
    alert("Maintenance Request Submitted!\nTicket #: " + ticket);

    // Clear form
    document.getElementById("requester").value = "";
    document.getElementById("contact").value = "";
    document.getElementById("resHouse").value = "";
    document.getElementById("expectedDate").value = "";
    document.getElementById("description").value = "";
    document.getElementById("materials").value = "";

    // Optionally redirect back to landing page
    // window.location.href = "index.html";

    // Log to Google Sheet
    const logData = {
      ticket, requester, contact, resHouse, dateSubmitted, expectedDate, description, materials
    };

    fetch("https://script.google.com/macros/library/d/1ttOv8ZNs2OYaDHy4H3t1bbsy0FpxaYHNZ7fFrUJO47wFDBuaFRKrjifJ/1", {
      method: "POST",
      body: JSON.stringify(logData)
    }).then(resp => console.log("Logged to Sheet:", resp))
      .catch(err => console.error("Sheet logging error:", err));

  }).catch(err => {
    console.error("EmailJS error:", err);
    alert("Failed to send request. Check console.");
  });
}
</script>

</body>
</html>

